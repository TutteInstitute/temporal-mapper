<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parameter Selection for Temporal Mapper &mdash; Temporal Mapper 0.3.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Visualizing TemporalMapper Graphs" href="visualization.html" />
    <link rel="prev" title="Understanding DBMapper" href="dbmapper_theory.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Temporal Mapper
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dbmapper_theory.html">Understanding DBMapper</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Parameter Selection for Temporal Mapper</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Number-of-Checkpoints:-N_checkpoints">Number of Checkpoints: <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Choice-of-Open-Cover:-slice_method">Choice of Open Cover: <code class="docutils literal notranslate"><span class="pre">slice_method</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Choice-of-Clustering-Algorithm:-clusterer">Choice of Clustering Algorithm: <code class="docutils literal notranslate"><span class="pre">clusterer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Number-of-Nearest-Neighbours:-neighbours">Number of Nearest-Neighbours: <code class="docutils literal notranslate"><span class="pre">neighbours</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Temporal-Kernel:-kernel">Temporal Kernel: <code class="docutils literal notranslate"><span class="pre">kernel</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualizing TemporalMapper Graphs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">TemporalMapper API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Temporal Mapper</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Parameter Selection for Temporal Mapper</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/paramselection.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Parameter-Selection-for-Temporal-Mapper">
<h1>Parameter Selection for Temporal Mapper<a class="headerlink" href="#Parameter-Selection-for-Temporal-Mapper" title="Permalink to this heading"></a></h1>
<p>On this page, we will describe the critical parameters of <code class="docutils literal notranslate"><span class="pre">temporalmapper.TemporalMapper</span></code>, and give advice on how to select them for your data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">temporalmapper</span> <span class="k">as</span> <span class="nn">tm</span>
<span class="kn">import</span> <span class="nn">temporalmapper.utilities_</span> <span class="k">as</span> <span class="nn">tmutils</span>
<span class="kn">import</span> <span class="nn">temporalmapper.weighted_clustering</span> <span class="k">as</span> <span class="nn">tmwc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
<span class="kn">import</span> <span class="nn">datamapplot</span> <span class="k">as</span> <span class="nn">dmp</span>

<span class="n">demo_data_file</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://github.com/TutteInstitute/temporal-mapper/raw/docs/docs/data/genus1_demo.npy&quot;</span><span class="p">)</span>
<span class="n">data_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">demo_data_file</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
<span class="n">data_unsort</span> <span class="o">=</span> <span class="n">data_time</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="n">time_unsort</span> <span class="o">=</span> <span class="n">data_time</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">time_unsort</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data_unsort</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">time_unsort</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Semantic space ($\mathbb</span><span class="si">{R}</span><span class="s2">^d$)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;f(x)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/paramselection_1_0.png" src="_images/paramselection_1_0.png" />
</div>
</div>
<section id="Number-of-Checkpoints:-N_checkpoints">
<h2>Number of Checkpoints: <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code><a class="headerlink" href="#Number-of-Checkpoints:-N_checkpoints" title="Permalink to this heading"></a></h2>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code> has the greatest impact on the output of Mapper, so it is important to make a reasonable choice.</p>
<p>If we had infintely many data points, then the theory tells us that there is some maximum <code class="docutils literal notranslate"><span class="pre">M</span></code> such that for <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span> <span class="pre">&gt;</span> <span class="pre">M</span></code>, the Mapper graph will capture all the topological features. For this reason, we want to take <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code> large. However with finite data, as <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code> is increased, the output graph will become more and more disconnected. This defines the following trade-off:</p>
<p>As <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code>$ :nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>to`$∞, the <strong>amount of features captured increases</strong> and the <strong>amount of discretization artifacts increases</strong>.</p>
<p>To avoid having many artifacts, it is important that each time interval has enough points for the clustering to be reasonable. This gives a heuristic; if you need at least <span class="math notranslate nohighlight">\(s\)</span> points to trust the clustering algorithm, and you have <span class="math notranslate nohighlight">\(n\)</span> samples, then you can take <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code> <span class="math notranslate nohighlight">\(\approxeq n/s\)</span>.</p>
<p>For DBMapper, which is the default for <code class="docutils literal notranslate"><span class="pre">tm.TemporalMapper</span></code>, the clustering intervals get strictly larger than in default Mapper, and hence you can afford to choose a larger <code class="docutils literal notranslate"><span class="pre">N_checkpoints</span></code> then you would for Mapper.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">checkpoint_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">checkpoint_numbers</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">checkpoint_numbers</span><span class="p">))</span>
<span class="n">clusterer</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">()</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">checkpoint_numbers</span><span class="p">)):</span>
    <span class="n">TM</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">TemporalMapper</span><span class="p">(</span>
        <span class="n">time</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">clusterer</span><span class="p">,</span>
        <span class="n">N_checkpoints</span> <span class="o">=</span> <span class="n">checkpoint_numbers</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
        <span class="n">neighbours</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">kernel</span><span class="o">=</span><span class="n">tmwc</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">TM</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">tmutils</span><span class="o">.</span><span class="n">time_semantic_plot</span><span class="p">(</span><span class="n">TM</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xmin</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ymin</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="sa">fr</span><span class="s1">&#39;$n$=</span><span class="si">{</span><span class="n">TM</span><span class="o">.</span><span class="n">N_checkpoints</span><span class="si">}</span><span class="s1">, $g$=</span><span class="si">{</span><span class="n">TM</span><span class="o">.</span><span class="n">g</span><span class="si">}</span><span class="s1">, $k$=</span><span class="si">{</span><span class="mi">50</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k</span><span class="o">%</span><span class="k">4</span>==3:
        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/paramselection_3_0.png" src="_images/paramselection_3_0.png" />
</div>
</div>
</section>
<section id="Choice-of-Open-Cover:-slice_method">
<h2>Choice of Open Cover: <code class="docutils literal notranslate"><span class="pre">slice_method</span></code><a class="headerlink" href="#Choice-of-Open-Cover:-slice_method" title="Permalink to this heading"></a></h2>
<p>The next most impactful choice is the method used to choose the time-intervals used in Mapper. Temporal Mapper includes two natural choices, <code class="docutils literal notranslate"><span class="pre">slice_method='time'</span></code> and <code class="docutils literal notranslate"><span class="pre">slice_method='data'</span></code>. Using <code class="docutils literal notranslate"><span class="pre">time</span></code>, the intervals are evenly spaced in time, and using <code class="docutils literal notranslate"><span class="pre">data</span></code>, the intervals have even amounts of data in them. Using <code class="docutils literal notranslate"><span class="pre">time</span></code> is generally fine, but if your data is very unevenly distributed in time, then using <code class="docutils literal notranslate"><span class="pre">data</span></code> can provide more consistent results.</p>
</section>
<section id="Choice-of-Clustering-Algorithm:-clusterer">
<h2>Choice of Clustering Algorithm: <code class="docutils literal notranslate"><span class="pre">clusterer</span></code><a class="headerlink" href="#Choice-of-Clustering-Algorithm:-clusterer" title="Permalink to this heading"></a></h2>
<p>For the most part, your choice of clustering algorithm for Temporal-Mapper is informed by the same trade-offs as any clustering problem. For this purpose, the <a class="reference external" href="https://scikit-learn.org/stable/modules/clustering.html">Scikit-Learn documentation</a> provides a good overview. However, there is one extra thing to note for Temporal Mapper: in Mapper, the clustering algorithm’s purpose is to determine the number of connected components of each slice of the data. Therefore, it is epistemologically
backwards to use a clustering algorithm that requires an a-priori choice of number of clusters, such as k-means. Instead, choose something like DBSCAN, which has variable number of clusters.</p>
</section>
<section id="Number-of-Nearest-Neighbours:-neighbours">
<h2>Number of Nearest-Neighbours: <code class="docutils literal notranslate"><span class="pre">neighbours</span></code><a class="headerlink" href="#Number-of-Nearest-Neighbours:-neighbours" title="Permalink to this heading"></a></h2>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">neighbours</span></code>, or <span class="math notranslate nohighlight">\(k\)</span>, is the number of neighbours used in the approximation of the temporal density. As <span class="math notranslate nohighlight">\(k\)</span> and the number of samples grows, the approximation improves. However, for finite sample sizes, increasing <span class="math notranslate nohighlight">\(k\)</span> will average the temporal density as a function of the semantic-space co-ordinates; in the extreme, if <span class="math notranslate nohighlight">\(k&gt;\)</span> <code class="docutils literal notranslate"><span class="pre">n_samples</span></code>, the temporal density will be constant. Moreover, the <span class="math notranslate nohighlight">\(k\)</span> nearest-neighbours computation is one of the computation
bottlenecks in DBMapper, and therefore increasing <span class="math notranslate nohighlight">\(k\)</span> has a noticable performance cost on large datasets.</p>
<p>If your dataset is large (100k+), then we suggest taking <span class="math notranslate nohighlight">\(k\)</span> as large as your computational budget allows. If your dataset is very small, then taking large <span class="math notranslate nohighlight">\(k\)</span> is likely to over-average the temporal density. In this case, start with <span class="math notranslate nohighlight">\(k\)</span> around 50-100.</p>
</section>
<section id="Temporal-Kernel:-kernel">
<h2>Temporal Kernel: <code class="docutils literal notranslate"><span class="pre">kernel</span></code><a class="headerlink" href="#Temporal-Kernel:-kernel" title="Permalink to this heading"></a></h2>
<p>The choice of temporal kernel has two effects on the output of temporal mapper. The kernel defines weights for the samples, which are passed to the clustering algorithm, and which are used to weigh edges of the output graph.</p>
<p>If you are using a clustering algorithm which does not support sample weights, and you are not using weighted edges on the Mapper graph, then there is no mathematical advantage to using a non-square kernel; in this case set <code class="docutils literal notranslate"><span class="pre">kernel=tmwc.square</span></code>, for a minor performance improvement.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dbmapper_theory.html" class="btn btn-neutral float-left" title="Understanding DBMapper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="visualization.html" class="btn btn-neutral float-right" title="Visualizing TemporalMapper Graphs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1980, Kaleb D Ruscitti.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>